{"componentChunkName":"component---src-templates-blog-post-js","path":"/foundamention/react/调度/","result":{"data":{"site":{"siteMetadata":{"title":"chinley's blog"}},"markdownRemark":{"id":"93123f7c-2bd5-5901-9af4-30af5b060234","excerpt":"React 调度 相关阅读 深入理解 scheduler 原理\nhttps://mp.weixin.qq.com/s/0vomFnPPNb27E76LBIQcsA 前言   React可以运行在node环境和浏览器环境中，在不同环境下实现requestHostCallback等函数采用不同的方式，在node…","html":"<h2>React 调度</h2>\n<h6>相关阅读</h6>\n<p>深入理解 scheduler 原理\n<a href=\"https://mp.weixin.qq.com/s/0vomFnPPNb27E76LBIQcsA\">https://mp.weixin.qq.com/s/0vomFnPPNb27E76LBIQcsA</a></p>\n<h4>前言</h4>\n<p>  React可以运行在node环境和浏览器环境中，在不同环境下实现requestHostCallback等函数采用不同的方式，在node下采用setTimeout实现任务的及时调用。</p>\n<h4>调度的实现</h4>\n<p>  调度中心比较重要的函数在SchedulerHostConfig.default.js中，该文件导出了8个函数</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">export</span> <span class=\"token keyword\">let</span> requestHostCallback<span class=\"token punctuation\">;</span><span class=\"token comment\">//请求及时回调 </span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">let</span> cancelHostCallback<span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">let</span> requestHostTimeout<span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">let</span> cancelHostTimeout<span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">let</span> shouldYieldToHost<span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">let</span> requestPaint<span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">let</span> getCurrentTime<span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">let</span> forceFrameRate<span class=\"token punctuation\">;</span></code></pre></div>\n<h5>调度相关</h5>\n<p>  请求或取消调度，用于通知消息请求调用或者注册异步任务等待调用</p>\n<ul>\n<li>\n<p>requestHostCallback</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token function-variable function\">requestHostCallback</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">callback</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\nscheduledHostCallback <span class=\"token operator\">=</span> callback<span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>isMessageLoopRunning<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  isMessageLoopRunning <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span>\n  port<span class=\"token punctuation\">.</span><span class=\"token function\">postMessage</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n</li>\n<li>\n<p>cancelHostCallback</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token function-variable function\">requestHostCallback</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">callback</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\nscheduledHostCallback <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n</li>\n<li>\n<p>requestHostTimeout</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token function-variable function\">requestHostTimeout</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">callback<span class=\"token punctuation\">,</span> ms</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\ntaskTimeoutID <span class=\"token operator\">=</span> <span class=\"token function\">setTimeout</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">callback</span><span class=\"token punctuation\">(</span><span class=\"token function\">getCurrentTime</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> ms<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n</li>\n<li>\n<p>cancelHostTimeout</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token function-variable function\">cancelHostTimeout</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n<span class=\"token function\">clearTimeout</span><span class=\"token punctuation\">(</span>taskTimeoutID<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\ntaskTimeoutID <span class=\"token operator\">=</span> <span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h6>ScheduleCallback注册任务</h6>\n</li>\n</ul>","frontmatter":{"title":"React调度","date":"June 07, 2022","description":null}},"previous":{"fields":{"slug":"/http/基础篇/"},"frontmatter":{"title":"透视HTTP协议"}},"next":{"fields":{"slug":"/http/进阶篇/"},"frontmatter":{"title":"透视HTTP协议"}}},"pageContext":{"id":"93123f7c-2bd5-5901-9af4-30af5b060234","previousPostId":"e35cfae2-861b-5721-b507-fe15cdfb7135","nextPostId":"6812592a-9f5d-5361-ab85-785ef5b56da5"}},"staticQueryHashes":["2841359383","788015585"]}