{"componentChunkName":"component---src-templates-blog-post-js","path":"/foundamention/html/懒加载/","result":{"data":{"site":{"siteMetadata":{"title":"chinley's blog"}},"markdownRemark":{"id":"add0b9f3-4101-5c7c-9c03-9227bac98c19","excerpt":"如何实现图片懒加载 使用img lazyloading属性   缺点： 兼容性不好\n   IntersectionObserver + data set   IntersectionObserver 能够监听元素是否到了当前视窗，再动态设置元素的src getBoundingClientRect + Scroll…","html":"<h2>如何实现图片懒加载</h2>\n<h4>使用img lazyloading属性</h4>\n<p>  缺点： 兼容性不好\n<img src=\"shanyue.jpg\" loading=\"lazy\" /></p>\n<h4>IntersectionObserver + data set</h4>\n<p>  IntersectionObserver 能够监听元素是否到了当前视窗，再动态设置元素的src</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> observer <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">IntersectionObserver</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">changes</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// changes: 目标元素集合</span>\n  changes<span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">change</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// intersectionRatio</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>change<span class=\"token punctuation\">.</span>isIntersecting<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">const</span> img <span class=\"token operator\">=</span> change<span class=\"token punctuation\">.</span>target<span class=\"token punctuation\">;</span>\n      img<span class=\"token punctuation\">.</span>src <span class=\"token operator\">=</span> img<span class=\"token punctuation\">.</span>dataset<span class=\"token punctuation\">.</span>src<span class=\"token punctuation\">;</span>\n      observer<span class=\"token punctuation\">.</span><span class=\"token function\">unobserve</span><span class=\"token punctuation\">(</span>img<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\nobserver<span class=\"token punctuation\">.</span><span class=\"token function\">observe</span><span class=\"token punctuation\">(</span>img<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h4>getBoundingClientRect + Scroll + data set</h4>\n<p>  如何判断图片出现在了当前窗口</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">img<span class=\"token punctuation\">.</span><span class=\"token function\">getBoundingClientRect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>top <span class=\"token operator\">&lt;</span> document<span class=\"token punctuation\">.</span>documentElement<span class=\"token punctuation\">.</span>clientHeight<span class=\"token punctuation\">;</span></code></pre></div>\n<p>  监听window.scroll事件，动态设置img的src</p>","frontmatter":{"title":"懒加载","date":"May 08, 2022","description":null}},"previous":{"fields":{"slug":"/foundamention/防抖与节流/"},"frontmatter":{"title":"防抖与节流"}},"next":{"fields":{"slug":"/foundamention/html/cookie作用域/"},"frontmatter":{"title":"cookie在同域名不同端口可以共享吗"}}},"pageContext":{"id":"add0b9f3-4101-5c7c-9c03-9227bac98c19","previousPostId":"63173176-cd8b-5b9b-9873-5232613e412b","nextPostId":"6f558a2d-dac8-52f5-b551-f16351c94094"}},"staticQueryHashes":["2841359383","788015585"]}